document.addEventListener('DOMContentLoaded',function(){const canvas=document.getElementById('thumbnailCanvas');const ctx=canvas.getContext('2d');const titleInput=document.getElementById('title');const excerptInput=document.getElementById('excerpt');const authorInput=document.getElementById('author');const blogNameInput=document.getElementById('blogName');const logoInput=document.getElementById('logo');const bgColorInput=document.getElementById('bgColor');const generateBtn=document.getElementById('generateBtn');const downloadJpgBtn=document.getElementById('downloadJpgBtn');const downloadPngBtn=document.getElementById('downloadPngBtn');const downloadWebpBtn=document.getElementById('downloadWebpBtn');const resetBtn=document.getElementById('resetBtn');const aspectRatioSelect=document.getElementById('aspectRatio');const bgOpacityInput=document.getElementById('bgOpacity');const bgOpacityValue=document.getElementById('bgOpacityValue');const publishDateInput=document.getElementById('publishDate');let currentPattern='dots';const patternOpacityInput=document.getElementById('patternOpacity');const patternOpacityValue=document.getElementById('patternOpacityValue');

const patterns = { dots: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><circle cx='20' cy='20' r='2' fill='{color}'/><circle cx='50' cy='20' r='2' fill='{color}'/><circle cx='80' cy='20' r='2' fill='{color}'/><circle cx='20' cy='50' r='2' fill='{color}'/><circle cx='50' cy='50' r='2' fill='{color}'/><circle cx='80' cy='50' r='2' fill='{color}'/><circle cx='20' cy='80' r='2' fill='{color}'/><circle cx='50' cy='80' r='2' fill='{color}'/><circle cx='80' cy='80' r='2' fill='{color}'/></svg>`, waves: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><path d='M0,50 C20,70 40,30 60,50 S80,30 100,50 L100,100 L0,100 Z' fill='{color}'/></svg>`,  lines: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><line x1='0' y1='20' x2='100' y2='20' stroke='{color}' stroke-width='1'/><line x1='0' y1='40' x2='100' y2='40' stroke='{color}' stroke-width='1'/><line x1='0' y1='60' x2='100' y2='60' stroke='{color}' stroke-width='1'/><line x1='0' y1='80' x2='100' y2='80' stroke='{color}' stroke-width='1'/></svg>`, grid: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><path d='M 0 50 L 100 50 M 50 0 L 50 100' stroke='{color}' stroke-width='1'/></svg>`, circles: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'><circle cx='20' cy='20' r='10' fill='none' stroke='{color}' stroke-width='1'/><circle cx='80' cy='20' r='10' fill='none' stroke='{color}' stroke-width='1'/><circle cx='50' cy='50' r='10' fill='none' stroke='{color}' stroke-width='1'/><circle cx='20' cy='80' r='10' fill='none' stroke='{color}' stroke-width='1'/><circle cx='80' cy='80' r='10' fill='none' stroke='{color}' stroke-width='1'/></svg>`, none: 'none'
};patternOptions.addEventListener('click',function(e){const patternOption=e.target.closest('.tb-pattern-option');if(patternOption){document.querySelectorAll('.tb-pattern-option').forEach(opt=>{opt.classList.remove('selected')});patternOption.classList.add('selected');currentPattern=patternOption.dataset.pattern;generateThumbnail()}});patternOpacityInput.addEventListener('input',function(){patternOpacityValue.textContent=this.value+'%';generateThumbnail()});const titleColorInput=document.getElementById('titleColor');const excerptColorInput=document.getElementById('excerptColor');const authorColorInput=document.getElementById('authorColor');const blogNameColorInput=document.getElementById('blogNameColor');const patternColorInput=document.getElementById('patternColor');const titleSizeInput=document.getElementById('titleSize');const titleSizeValue=document.getElementById('titleSizeValue');const excerptSizeInput=document.getElementById('excerptSize');const excerptSizeValue=document.getElementById('excerptSizeValue');const authorSizeInput=document.getElementById('authorSize');const authorSizeValue=document.getElementById('authorSizeValue');const blogNameSizeInput=document.getElementById('blogNameSize');const blogNameSizeValue=document.getElementById('blogNameSizeValue');const bgImageInput=document.getElementById('bgImage');const bgImageColorGroup=document.getElementById('bgImageColorGroup');const customBgImageColorGroup=document.getElementById('customBgImageColorGroup');const customBgImageColorInput=document.getElementById('customBgImageColor');let uploadedLogo=null;let uploadedBgImage=null;const today=new Date();const formattedDate=today.toISOString().split('T')[0];publishDateInput.value=formattedDate;titleSizeInput.addEventListener('input',function(){titleSizeValue.textContent=this.value+'px';generateThumbnail()});excerptSizeInput.addEventListener('input',function(){excerptSizeValue.textContent=this.value+'px';generateThumbnail()});authorSizeInput.addEventListener('input',function(){authorSizeValue.textContent=this.value+'px';generateThumbnail()});blogNameSizeInput.addEventListener('input',function(){blogNameSizeValue.textContent=this.value+'px';generateThumbnail()});bgOpacityInput.addEventListener('input',function(){bgOpacityValue.textContent=this.value+'%';generateThumbnail()});aspectRatioSelect.addEventListener('change',function(){updateCanvasSize();generateThumbnail()});bgImageInput.addEventListener('change',function(e){const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=function(event){uploadedBgImage=new Image();uploadedBgImage.onload=function(){generateThumbnail()};uploadedBgImage.src=event.target.result};reader.readAsDataURL(file)}});logoInput.addEventListener('change',function(e){const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=function(event){uploadedLogo=new Image();uploadedLogo.onload=function(){generateThumbnail()};uploadedLogo.src=event.target.result};reader.readAsDataURL(file)}});generateBtn.addEventListener('click',generateThumbnail);downloadJpgBtn.addEventListener('click',()=>downloadThumbnail('jpg'));downloadPngBtn.addEventListener('click',()=>downloadThumbnail('png'));downloadWebpBtn.addEventListener('click',()=>downloadThumbnail('webp'));resetBtn.addEventListener('click',resetSettings);document.querySelectorAll('input[name="bgImageColorType"]').forEach(radio=>{radio.addEventListener('change',function(){customBgImageColorGroup.style.display=this.value==='custom'?'block':'none';generateThumbnail()})});function updateCanvasSize(){const ratio=aspectRatioSelect.value;const[widthRatio,heightRatio]=ratio.split('/').map(Number);const newWidth=800;const newHeight=Math.round(newWidth*heightRatio/widthRatio);canvas.width=newWidth;canvas.height=newHeight}function resetSettings(){titleInput.value='';excerptInput.value='';authorInput.value='';blogNameInput.value='';logoInput.value='';bgColorInput.value='#4a6fa5';titleColorInput.value='#333333';excerptColorInput.value='#333333';authorColorInput.value='#333333';blogNameColorInput.value='#333333';patternColorInput.value='#4a6fa5';titleSizeInput.value=40;excerptSizeInput.value=26;authorSizeInput.value=15;blogNameSizeInput.value=24;titleSizeValue.textContent='40px';excerptSizeValue.textContent='26px';authorSizeValue.textContent='15px';blogNameSizeValue.textContent='24px';bgOpacityInput.value=90;bgOpacityValue.textContent='90%';document.getElementById('fontSelect').selectedIndex=0;aspectRatioSelect.selectedIndex=0;document.querySelector('input[name="bgType"][value="image"]').checked=true;document.querySelector('input[name="bgImageColorType"][value="pattern"]').checked=true;customBgImageColorGroup.style.display='none';uploadedLogo=null;uploadedBgImage=null;bgImageInput.value='';currentPattern='dots';document.querySelectorAll('.tb-pattern-option').forEach(opt=>{opt.classList.remove('selected')});document.querySelector('.tb-pattern-option[data-pattern="dots"]').classList.add('selected');patternOpacityInput.value=20;patternOpacityValue.textContent='20%';publishDateInput.value=formattedDate;updateCanvasSize();generateThumbnail()}function generateThumbnail(){const title=titleInput.value||"عنوان المقال";const excerpt=excerptInput.value||"مقتطف المقال يظهر هنا...";const author=authorInput.value||"اسم المؤلف";const blogName=blogNameInput.value||"اسم المدونة";const bgColor=bgColorInput.value;const patternColor=patternColorInput.value;const selectedFont=document.getElementById('fontSelect').value;const bgOpacity=bgOpacityInput.value/100;const titleColor=titleColorInput.value;const excerptColor=excerptColorInput.value;const authorColor=authorColorInput.value;const blogNameColor=blogNameColorInput.value;const titleSize=parseInt(titleSizeInput.value);const excerptSize=parseInt(excerptSizeInput.value);const authorSize=parseInt(authorSizeInput.value);const blogNameSize=parseInt(blogNameSizeInput.value);const bgImageColorType=document.querySelector('input[name="bgImageColorType"]:checked').value;const bgImageEffectColor=bgImageColorType==='custom'?customBgImageColorInput.value:patternColor;const publishDate=new Date(publishDateInput.value);const arabicDate=formatArabicDate(publishDate);const patternOpacity=patternOpacityInput.value/100;ctx.clearRect(0,0,canvas.width,canvas.height);ctx.save();ctx.globalAlpha=bgOpacity;ctx.fillStyle=lightenColor(bgColor,90);ctx.fillRect(0,0,canvas.width,canvas.height);ctx.restore();if(currentPattern!=='none'){const patternImg=new Image();patternImg.onload=function(){const pattern=ctx.createPattern(patternImg,'repeat');ctx.save();ctx.globalAlpha=patternOpacity;ctx.fillStyle=pattern;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.restore();drawImageAndContent()};const patternWithColor=patterns[currentPattern].replace(/{color}/g,encodeURIComponent(patternColor));patternImg.src=patternWithColor}else{drawImageAndContent()}function drawImageAndContent(){if(uploadedBgImage){ctx.save();ctx.globalAlpha=bgOpacity;ctx.drawImage(uploadedBgImage,0,0,canvas.width,canvas.height);ctx.fillStyle=bgImageEffectColor;ctx.globalCompositeOperation='overlay';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.restore()}drawContent()}function drawContent(){if(uploadedLogo){const logoSize=60;const logoX=canvas.width-logoSize-30;const logoY=30;ctx.save();ctx.beginPath();ctx.arc(logoX+logoSize/2,logoY+logoSize/2,logoSize/2+5,0,Math.PI*2);ctx.fillStyle='rgba(255, 255, 255, 0.2)';ctx.shadowColor='rgba(0, 0, 0, 0.2)';ctx.shadowBlur=10;ctx.shadowOffsetY=5;ctx.fill();ctx.restore();ctx.drawImage(uploadedLogo,logoX,logoY,logoSize,logoSize);ctx.font=`bold ${blogNameSize}px ${selectedFont}`;ctx.fillStyle=blogNameColor;ctx.textAlign='right';ctx.shadowColor='rgba(0, 0, 0, 0.2)';ctx.shadowBlur=5;const maxBlogNameWidth=400;const blogNameMetrics=ctx.measureText(blogName);if(blogNameMetrics.width>maxBlogNameWidth){const words=blogName.split(' ');let line1='';let line2='';let part=0;for(let i=0;i<words.length;i++){const testLine=(part===0?line1:line2)+words[i]+' ';const testWidth=ctx.measureText(testLine).width;if(testWidth<=maxBlogNameWidth){if(part===0){line1=testLine}else{line2=testLine}}else{if(part===0){part=1;line2=words[i]+' '}else{break}}}ctx.fillText(line1.trim(),logoX-20,logoY+logoSize/2);ctx.fillText(line2.trim(),logoX-20,logoY+logoSize/2+blogNameSize+5)}else{ctx.fillText(blogName,logoX-20,logoY+logoSize/2+10)}}else if(blogName){ctx.font=`bold ${blogNameSize}px ${selectedFont}`;ctx.fillStyle=blogNameColor;ctx.textAlign='right';ctx.shadowColor='rgba(0, 0, 0, 0.2)';ctx.shadowBlur=5;ctx.fillText(blogName,canvas.width-30,70)}ctx.font=`italic ${authorSize}px ${selectedFont}`;ctx.fillStyle=authorColor;ctx.textAlign='left';ctx.shadowColor='rgba(0, 0, 0, 0.1)';ctx.shadowBlur=1;const authorX=canvas.width-200;const authorY=canvas.height-40;ctx.save();ctx.font=`16px 'Segoe UI Emoji','Noto Color Emoji'`;ctx.fillText('👤',authorX-40,authorY);ctx.restore();ctx.fillText(author,authorX-20,authorY);ctx.save();ctx.font=`16px 'Segoe UI Emoji','Noto Color Emoji'`;ctx.fillText('📅',authorX+ctx.measureText(author).width-5,authorY);ctx.restore();ctx.fillText(arabicDate,authorX+ctx.measureText(author).width+25,authorY);ctx.fillStyle=titleColor;ctx.font=`bold ${titleSize}px ${selectedFont}`;ctx.textAlign='right';ctx.shadowColor='rgba(0, 0, 0, 0.2)';ctx.shadowBlur=8;ctx.shadowOffsetY=3;const titleX=canvas.width-60;const titleY=160;const titleLineHeight=titleSize+10;const titleHeight=wrapTitleText(ctx,title,titleX,titleY,canvas.width-110,titleLineHeight);ctx.fillStyle=excerptColor;ctx.font=`${excerptSize}px ${selectedFont}`;ctx.textAlign='right';ctx.shadowColor='rgba(0, 0, 0, 0.1)';ctx.shadowBlur=3;const excerptX=canvas.width-60;const excerptMaxWidth=canvas.width-120;const excerptStartY=titleY+titleHeight+20;wrapTextModern(ctx,excerpt,excerptX,excerptStartY,excerptMaxWidth,excerptSize+6)}drawImageAndContent()}function wrapTitleText(ctx,text,x,y,maxWidth,lineHeight=40,maxLines=2){const words=text.split(' ');const lines=[];let currentLine=words[0]||'';for(let i=1;i<words.length;i++){const testLine=currentLine+' '+words[i];const testWidth=ctx.measureText(testLine).width;if(testWidth<=maxWidth&&lines.length<maxLines-1){currentLine=testLine}else{lines.push(currentLine);currentLine=words[i];if(lines.length===maxLines-1){let finalLine=currentLine;while(ctx.measureText(finalLine+'...').width>maxWidth&&finalLine.length>0){finalLine=finalLine.slice(0,-1)}lines.push(finalLine+'...');break}}}if(lines.length<maxLines&&currentLine&&!lines.includes(currentLine)){lines.push(currentLine)}const totalLines=lines.length;const offsetY=totalLines===2?lineHeight/2:0;const startY=y-offsetY;for(let i=0;i<totalLines;i++){ctx.fillText(lines[i],x,startY+(i*lineHeight))}return totalLines*lineHeight}function wrapTextModern(context,text,x,y,maxWidth,lineHeight=30){const words=text.split(' ');let lines=[];let currentLine=words[0];for(let i=1;i<words.length;i++){const word=words[i];const testLine=currentLine+' '+word;const metrics=context.measureText(testLine);if(metrics.width<=maxWidth){currentLine=testLine}else{lines.push(currentLine);currentLine=word}}lines.push(currentLine);const maxVisibleLines=4;const visibleLines=lines.slice(0,maxVisibleLines);if(lines.length>maxVisibleLines){let lastLine=visibleLines[visibleLines.length-1];while(context.measureText(lastLine+'...').width>maxWidth&&lastLine.length>0){lastLine=lastLine.slice(0,-1)}visibleLines[visibleLines.length-1]=lastLine+'...'}for(let i=0;i<visibleLines.length;i++){context.fillText(visibleLines[i],x,y+(i*lineHeight))}}function formatArabicDate(date){if(isNaN(date.getTime()))return 'تاريخ غير محدد';const arabicMonths=['يناير','فبراير','مارس','أبريل','مايو','يونيو','يوليو','أغسطس','سبتمبر','أكتوبر','نوفمبر','ديسمبر'];const day=date.getDate();const month=arabicMonths[date.getMonth()];const year=date.getFullYear();return `${day}${month}${year}`}function downloadThumbnail(format='png'){let mimeType,fileExtension;switch(format){case 'jpg':mimeType='image/jpeg';fileExtension='jpg';break;case 'png':mimeType='image/png';fileExtension='png';break;case 'webp':mimeType='image/webp';fileExtension='webp';break;default:mimeType='image/png';fileExtension='png'}const link=document.createElement('a');link.download=`thumbnail-${Date.now()}.${fileExtension}`;link.href=canvas.toDataURL(mimeType,0.9);link.click()}function lightenColor(color,percent){const num=parseInt(color.replace('#',''),16);const amt=Math.round(2.55*percent);const R=(num>>16)+amt;const G=(num>>8&0x00FF)+amt;const B=(num&0x0000FF)+amt;return '#'+(0x1000000+(R<255?(R<1?0:R):255)*0x10000+(G<255?(G<1?0:G):255)*0x100+(B<255?(B<1?0:B):255)).toString(16).slice(1)}function hexToRgba(hex,alpha){const r=parseInt(hex.slice(1,3),16);const g=parseInt(hex.slice(3,5),16);const b=parseInt(hex.slice(5,7),16);return `rgba(${r},${g},${b},${alpha})`}updateCanvasSize();generateThumbnail()});</script>

<script>function setActiveTab(tabNumber){const tabsContainer=document.querySelector('.settings-tabs');tabsContainer.setAttribute('data-active-tab',tabNumber);document.querySelectorAll('.tab-btn').forEach((btn,index)=>{if(index===tabNumber-1){btn.classList.add('active')}else{btn.classList.remove('active')}});document.querySelectorAll('.tab-content').forEach((content,index)=>{if(index===tabNumber-1){content.classList.add('active')}else{content.classList.remove('active')}})}document.querySelectorAll('input[type="range"]').forEach(range=>{range.addEventListener('input',()=>{const valueSpan=document.getElementById(`${range.id}Value`);if(valueSpan){valueSpan.textContent=`${range.value}${range.id.includes('Opacity')?'%':'px'}`}})});document.querySelectorAll('.tab-btn').forEach(button=>{button.addEventListener('click',(e)=>{const tabId=e.currentTarget.getAttribute('data-tab');document.querySelectorAll('.tab-content').forEach(content=>{content.classList.remove('active')});document.getElementById(`${tabId}-tab`).classList.add('active')})});document.addEventListener('DOMContentLoaded',function(){const accordionHeader=document.querySelector('.accordion__header');const accordionContent=document.querySelector('.accordion__content');accordionHeader.addEventListener('click',function(){const isExpanded=this.getAttribute('aria-expanded')==='true';this.setAttribute('aria-expanded',!isExpanded);accordionContent.setAttribute('aria-hidden',isExpanded);if(isExpanded){accordionContent.style.display='none'}else{accordionContent.style.display='block'}});document.querySelectorAll('.size-control__btn').forEach(button=>{button.addEventListener('click',function(e){e.preventDefault();const action=this.dataset.action;const target=this.dataset.target;const valueElement=document.getElementById(`${target}Value`);const hiddenInput=document.getElementById(target);let currentSize=parseInt(valueElement.textContent);if(action==='increase'){currentSize+=1}else{currentSize=Math.max(1,currentSize-1)}valueElement.textContent=currentSize+'px';hiddenInput.value=currentSize})})});
